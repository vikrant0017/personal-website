---
import {
    Card,
    CardContent,
    CardDescription,
    CardHeader,
    CardTitle,
} from "./ui/card";
import { Button } from "./ui/button";
import { loadResumeData, hasSocialLinks } from "../lib/resume";

const resumeData = loadResumeData();
const personal = resumeData.personal || {};

// Format links with proper protocols
const formatLink = (link?: string, type?: string): string => {
    if (!link) return "#";
    if (link.startsWith("http://") || link.startsWith("https://")) {
        return link;
    }
    if (type === "email") {
        return `mailto:${link}`;
    }
    if (type === "phone") {
        return `tel:${link}`;
    }
    return `https://${link}`;
};

interface ContactMethod {
    icon: string;
    title: string;
    description: string;
    value: string;
    link: string;
}

const contactMethods: ContactMethod[] = [
    personal.email && {
        icon: "mail",
        title: "Email",
        description: "Send me an email",
        value: personal.email,
        link: formatLink(personal.email, "email"),
    },
    personal.linkedin && {
        icon: "linkedin",
        title: "LinkedIn",
        description: "Connect with me",
        value: personal.linkedin,
        link: formatLink(personal.linkedin),
    },
    personal.github && {
        icon: "github",
        title: "GitHub",
        description: "Check out my code",
        value: personal.github,
        link: formatLink(personal.github),
    },
].filter((method): method is ContactMethod => Boolean(method));

const hasContactInfo = contactMethods.length > 0;
---

<section id="contact" class="container max-w-screen-2xl px-4 py-16 md:py-24">
    <div class="mb-12 text-center">
        <h2 class="text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl">
            Get In Touch
        </h2>
        <p class="mt-4 text-lg text-muted-foreground">
            Have a project in mind or want to collaborate? Feel free to reach
            out!
        </p>
    </div>

    <div class="mx-auto max-w-4xl">
        {
            hasContactInfo && (
                <div class="grid gap-6 md:grid-cols-3">
                    {contactMethods.map((method) => (
                        <Card
                            client:load
                            className="transition-shadow hover:shadow-lg"
                        >
                            <CardHeader>
                                <div class="mb-2 flex h-12 w-12 items-center justify-center rounded-lg bg-primary text-primary-foreground">
                                    {method.icon === "mail" && (
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="24"
                                            height="24"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="2"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                        >
                                            <rect
                                                width="20"
                                                height="16"
                                                x="2"
                                                y="4"
                                                rx="2"
                                            />
                                            <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7" />
                                        </svg>
                                    )}
                                    {method.icon === "linkedin" && (
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="24"
                                            height="24"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="2"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                        >
                                            <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" />
                                            <rect
                                                width="4"
                                                height="12"
                                                x="2"
                                                y="9"
                                            />
                                            <circle cx="4" cy="4" r="2" />
                                        </svg>
                                    )}
                                    {method.icon === "github" && (
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="24"
                                            height="24"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="2"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                        >
                                            <path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4" />
                                            <path d="M9 18c-4.51 2-5-2-7-2" />
                                        </svg>
                                    )}
                                </div>
                                <CardTitle>{method.title}</CardTitle>
                                <CardDescription>
                                    {method.description}
                                </CardDescription>
                            </CardHeader>
                            <CardContent>
                                <a
                                    href={method.link}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="text-sm text-primary hover:underline break-all"
                                >
                                    {method.value}
                                </a>
                            </CardContent>
                        </Card>
                    ))}
                </div>
            )
        }
    </div>
</section>
