---
import { loadResumeData, loadConfigData, getLogoForSkill } from "../lib/resume";

const resumeData = loadResumeData();
const configData = loadConfigData();
const skills = resumeData.skills || {};
const logos = configData.logos || [];

// Collect all skills into a flat array with their categories
const allSkills: Array<{ name: string; category: string }> = [];

if (skills.languages) {
    skills.languages.forEach((skill) => {
        allSkills.push({ name: skill, category: "Languages" });
    });
}
if (skills.frameworks) {
    skills.frameworks.forEach((skill) => {
        allSkills.push({ name: skill, category: "Frameworks & Libraries" });
    });
}
if (skills.databases) {
    skills.databases.forEach((skill) => {
        allSkills.push({ name: skill, category: "Databases" });
    });
}
if (skills.tools) {
    skills.tools.forEach((skill) => {
        allSkills.push({ name: skill, category: "Tools & Technologies" });
    });
}
if (skills.concepts) {
    skills.concepts.forEach((skill) => {
        allSkills.push({ name: skill, category: "Concepts" });
    });
}
---

<section id="about" class="container max-w-screen-2xl px-4 py-16 md:py-24">
    <div class="mb-12 text-center">
        <h2 class="text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl">
            Skills & Technologies
        </h2>
        <p class="mt-4 text-lg text-muted-foreground">
            Technologies I work with and have expertise in.
        </p>
    </div>

    <div class="mx-auto max-w-6xl">
        {
            allSkills.length > 0 && (
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6">
                    {allSkills.map((skill) => {
                        const logoData = getLogoForSkill(skill.name, logos);
                        const logoPath = logoData?.logo
                            ? `/logos/${logoData.logo}`
                            : "/logos/placeholder.svg";
                        const url = logoData?.url || "#";
                        const hasValidUrl =
                            !!logoData?.url && logoData.url !== "#";

                        return (
                            <a
                                href={url}
                                target={hasValidUrl ? "_blank" : undefined}
                                rel={
                                    hasValidUrl
                                        ? "noopener noreferrer"
                                        : undefined
                                }
                                class="group flex flex-col items-center justify-center p-4 rounded-lg hover:bg-accent/50 transition-all duration-200 hover:scale-105"
                                title={skill.name}
                            >
                                <div class="w-12 h-12 mb-3 flex items-center justify-center">
                                    <img
                                        src={logoPath}
                                        alt={`${skill.name} logo`}
                                        class="w-full h-full object-contain group-hover:scale-110 transition-transform duration-200"
                                        loading="lazy"
                                    />
                                </div>
                                <span class="text-sm font-medium text-center text-foreground group-hover:text-accent-foreground">
                                    {skill.name}
                                </span>
                            </a>
                        );
                    })}
                </div>
            )
        }
    </div>
</section>
